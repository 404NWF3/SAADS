graph LR
    %% Universal Layer - Placed on the left side
    subgraph UniversalLayer["Universal Layer (通用层，持续运行)"]
        direction LR
        WP11["<b>WP1-1: Intelligence Gathering</b><br>情报采集"]
        IntelDB["<b>产出:</b><br>威胁情报与<br>AI BOM 知识库"]
        WP12["<b>WP1-2: Penetration Testing</b><br>渗透测试"]
        TestDB["<b>产出:</b><br>通用测试方案<br>与脚本库"]

        WP11 -- "生成" --> IntelDB
        IntelDB -- "作为输入" --> WP12
        WP12 -- "生成" --> TestDB
    end

    %% User Layer - Placed on the right side
    subgraph UserLayer["User Layer (用户层，接入后启动)"]
        direction TB
        WP13["<b>WP1-3: Sandbox Simulation 沙盒模拟</b><br><br>1. 接入用户系统，进行虚拟化克隆<br>2. 解析用户系统的 AI BOM<br>3. 匹配 AI BOM 与情报库 → 筛选相关威胁/脚本<br>4. 在沙盒环境中执行测试<br>5. 采集测试过程数据 流量/日志/交互记录"]
        
        WP14["<b>WP1-4: Intrusion Detection 异常检测</b><br><br>• 基于采集的异常/正常数据训练检测模型<br>• 借助 ADBench 等工具自动选择最优算法<br>• 结合沙盒模拟智能体进行模型迭代优化"]
        
        WP13 -- "采集的数据" --> WP14
    end

    %% Inter-Layer Data Flow from Left to Right
    IntelDB -- "输入" --> WP13
    TestDB -- "输入" --> WP13

    %% --- Styling ---
    classDef layer fill:#E1EDDC,stroke:#000000,stroke-width:1.5px,color:black
    classDef processNode fill:#639DD0,color:#ffffff,stroke:#000000,stroke-width:2px
    classDef dataNode fill:#FFC79A,color:#000000,stroke:#000000,stroke-width:2px

    class WP11,WP12,WP13,WP14 processNode
    class IntelDB,TestDB dataNode
