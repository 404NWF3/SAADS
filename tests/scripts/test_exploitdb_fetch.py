#!/usr/bin/env python3
"""
æµ‹è¯• Exploit-DB æœç´¢åŠŸèƒ½ã€‚

éªŒè¯ä» Exploit-DB é‡‡é›†å…¬å¼€æ¼æ´åˆ©ç”¨ä¿¡æ¯çš„èƒ½åŠ›ã€‚
"""

import json
import sys
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ° Python è·¯å¾„
project_root = Path(__file__).resolve().parent.parent.parent
sys.path.insert(0, str(project_root))

from saads.tools.api_tools import _search_exploitdb_impl


def test_exploitdb_search():
    """æµ‹è¯• Exploit-DB æœç´¢åŠŸèƒ½ã€‚"""
    print("=" * 80)
    print("æµ‹è¯• Exploit-DB æœç´¢")
    print("=" * 80)

    test_queries = [
        ("python AI", 5),
        ("machine learning", 5),
        ("neural network", 5),
    ]

    for query, max_results in test_queries:
        print(f"\n{'=' * 80}")
        print(f"æœç´¢: '{query}' (max_results={max_results})")
        print("=" * 80)

        result = _search_exploitdb_impl(query, max_results)

        # æ£€æŸ¥æ˜¯å¦è¿”å›é”™è¯¯
        if result.startswith("Error"):
            print(f"âŒ é”™è¯¯: {result}")
            continue

        # è§£æ JSON ç»“æœ
        try:
            data = json.loads(result)
            print(f"âœ… æˆåŠŸè·å– {len(data)} æ¡ç»“æœ\n")

            # æ˜¾ç¤ºç»“æœè¯¦æƒ…
            for idx, item in enumerate(data, 1):
                print(f"\nğŸ’£ Exploit #{idx}:")
                print(f"  æ ‡é¢˜: {item.get('title', 'N/A')}")
                print(f"  URL: {item.get('url', 'N/A')}")
                if "edb_id" in item:
                    print(f"  EDB-ID: {item.get('edb_id', 'N/A')}")
                desc = item.get("description", "")
                if desc:
                    print(f"  æè¿°: {desc[:200]}")

        except json.JSONDecodeError as e:
            print(f"âŒ JSON è§£æå¤±è´¥: {e}")
            print(f"åŸå§‹å“åº”: {result[:500]}")


def main():
    """ä¸»å‡½æ•°ã€‚"""
    print("\nğŸš€ å¼€å§‹æµ‹è¯• Exploit-DB æœç´¢\n")

    test_exploitdb_search()

    print("\n" + "=" * 80)
    print("âœ… Exploit-DB æµ‹è¯•å®Œæˆ")
    print("=" * 80)


if __name__ == "__main__":
    main()
